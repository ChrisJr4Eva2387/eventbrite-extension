!function(){function a(){"use strict";null!==i&&i.apply(this,arguments)}function b(){"use strict";null!==l&&l.apply(this,arguments)}function c(a){"use strict";o.call(this,a),this.state={events:a.events||[],location:a.location,radius:a.radius,popularEvents:a.popularEvents||!1,nextWeekendEvents:a.nextWeekendEvents||!1,marathonEvents:a.marathonEvents||!1,likedEvents:a.likedEvents||[],showLiked:!1}}var d={TOKEN:"DB76SJDUSQFFHVNSQC6Y",API_ENDPOINT:"https://www.eventbriteapi.com/v3/events/search/",POSTDATA_DATE_FORMAT:"YYYY-MM-DDTHH:mm:ss[Z]",EVENT_DISPLAY_DATE_FORMAT:"ddd, MMM D h:mm A"},e=chrome.storage.local,f={},g=document.getElementById("app"),h=React.addons.CSSTransitionGroup,i=React.Component;for(var j in i)i.hasOwnProperty(j)&&(a[j]=i[j]);var k=null===i?null:i.prototype;a.prototype=Object.create(k),a.prototype.constructor=a,a.__superConstructor__=i,Object.defineProperty(a.prototype,"handleClick",{writable:!0,configurable:!0,value:function(a){"use strict";a.preventDefault(),chrome.tabs.create({url:$(a.currentTarget).attr("href")})}}),Object.defineProperty(a.prototype,"handleLikeClick",{writable:!0,configurable:!0,value:function(a,b){"use strict";this.props.onEventLike(a),$(b.currentTarget).toggleClass("liked"),b.stopPropagation()}}),Object.defineProperty(a.prototype,"render",{writable:!0,configurable:!0,value:function(){"use strict";var a,b=this.props.showLiked?this.props.likedEvents:this.props.events;if(0==b.length&&""!=$.trim(this.props.location))return React.createElement("div",{className:"no-events-found"},React.createElement("span",null,"Whoops! No events found."));if(this.props.showLiked)a=b;else if(this.props.marathonEvents){b=b.sort(function(a,b){return Math.floor(new Date(a.end.utc).getTime()/1e3)-Math.floor(new Date(b.end.utc).getTime()/1e3)}),a=[b[0]];for(var c=1;c<b.length;c++){var e=Math.floor(new Date(b[c].start.utc).getTime()/1e3),f=Math.floor(new Date(b[a.length-1].end.utc).getTime()/1e3);f>e&&a.push(b[c])}}else a=b;var b=a.map(function(a){var b=moment(a.start.local).format(d.EVENT_DISPLAY_DATE_FORMAT),c=(moment(a.end.local).format(d.EVENT_DISPLAY_DATE_FORMAT),[]),e=a.name.text,f="";if(a.hasOwnProperty("logo_url"))var g={backgroundImage:"url("+(a.logo_url?a.logo_url:"")+")"};else var g={backgroundImage:"url("+(a.logo?a.logo.url:"")+")"};var h=this.props.likedEvents.filter(function(b){return b.id==a.id}).length?"liked":"";return React.createElement("li",{key:a.id,className:"event-container"},React.createElement("a",{href:a.url,onClick:this.handleClick.bind(this)},React.createElement("div",{className:"event"},React.createElement("div",{className:"image",style:g,"data-adaptive-background":"1","data-ab-css-background":"1"}),React.createElement("div",{className:"body"},React.createElement("span",{className:"title"},e),React.createElement("span",{className:"like "+h,onClick:this.handleLikeClick.bind(this,a)}),React.createElement("span",{className:"organizer"},f),React.createElement("span",{className:"date"},b),c.length>0?React.createElement("span",{className:"address"},c.join(", ")):""))))},this);return React.createElement("div",null,React.createElement(h,{component:"ul",className:"events-list",transitionName:"events-list-transition"},b))}});var l=React.Component;for(var m in l)l.hasOwnProperty(m)&&(b[m]=l[m]);var n=null===l?null:l.prototype;b.prototype=Object.create(n),b.prototype.constructor=b,b.__superConstructor__=l,Object.defineProperty(b.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){"use strict";this.$settingsDropdown=$(React.findDOMNode(this.refs.settingsDropdown))}}),Object.defineProperty(b.prototype,"settingsClickHandler",{writable:!0,configurable:!0,value:function(){"use strict";this.$settingsDropdown.toggle()}}),Object.defineProperty(b.prototype,"showLikedEventsClickHandler",{writable:!0,configurable:!0,value:function(){"use strict";this.$settingsDropdown.hide(),this.props.onShowLikedEvents()}}),Object.defineProperty(b.prototype,"clearStorageClickHandler",{writable:!0,configurable:!0,value:function(){"use strict";this.$settingsDropdown.hide(),this.props.onClearStorageEvent()}}),Object.defineProperty(b.prototype,"render",{writable:!0,configurable:!0,value:function(){"use strict";return React.createElement("div",{id:"logo-container"},React.createElement("div",{id:"logo"}),React.createElement("div",{id:"settings"},React.createElement("i",{className:"icon",onClick:this.settingsClickHandler.bind(this)}),React.createElement("div",{className:"settings-dropdown",ref:"settingsDropdown"},React.createElement("ul",null,React.createElement("li",{onClick:this.showLikedEventsClickHandler.bind(this)},"Show liked"),React.createElement("li",{onClick:this.clearStorageClickHandler.bind(this)},"Clear storage")))))}});var o=React.Component;for(var p in o)o.hasOwnProperty(p)&&(c[p]=o[p]);var q=null===o?null:o.prototype;c.prototype=Object.create(q),c.prototype.constructor=c,c.__superConstructor__=o,Object.defineProperty(c.prototype,"getData",{writable:!0,configurable:!0,value:function(a,b,c,f,g){"use strict";var h=this,i={"location.address":a,"location.within":b+"mi",token:d.TOKEN};if(c&&(i.popular="on"),f){var j=moment().add(1,"weeks").endOf("isoWeek").subtract(2,"day").add(1,"second"),k=moment().add(1,"weeks").endOf("isoWeek");i["start_date.range_start"]=j.format(d.POSTDATA_DATE_FORMAT),i["start_date.range_end"]=k.format(d.POSTDATA_DATE_FORMAT)}$.ajax({url:d.API_ENDPOINT,type:"GET",dataType:"JSON",data:i,success:function(d){({location:a,locationRadius:b,popularEvents:c,nextWeekendEvents:f,marathonEvents:g,locationData:d.events.map(function(a){return{id:a.id,start:a.start,end:a.end,url:a.url,venue:a.venue,logo:a.logo,name:a.name,organizer:a.organizer}})});e.clear(),h.setState({events:d.events,location:a,radius:b,popularEvents:c,nextWeekendEvents:f,marathonEvents:g}),h.hideLoading()}})}}),Object.defineProperty(c.prototype,"shouldComponentUpdate",{writable:!0,configurable:!0,value:function(a,b){"use strict";var c=b.hasOwnProperty("silent");return c&&delete b.silent,b.hasOwnProperty("silent")?!b.silent:!0}}),Object.defineProperty(c.prototype,"componentDidMount",{writable:!0,configurable:!0,value:function(){"use strict";var a=this;this.searchInput=this.refs.searchInput.getDOMNode(),this.searchRadiusInput=this.refs.searchRadiusInput.getDOMNode(),this.popularEvents=this.refs.popularEvents.getDOMNode(),this.nextWeekendEvents=this.refs.nextWeekendEvents.getDOMNode(),this.marathonEvents=this.refs.marathonEvents.getDOMNode(),this.service=new google.maps.places.AutocompleteService,$(this.searchInput).typeahead({highlight:!0},{displayKey:"prediction",source:function(b,c){a.service.getPlacePredictions({input:b},function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&c($.map(a,function(a){return{prediction:a.description}}))})}}).on("typeahead:selected",function(b,c){a.showLoading(),a.getData(c.prediction,a.searchRadiusInput.value,a.popularEvents.checked,a.nextWeekendEvents.checked,a.marathonEvents.checked)}).on("focus",function(){$(".location-marker").css("opacity",1)}).on("focusout",function(){$(".location-marker").css("opacity",0)}),this.hideLoading(),$("body").on("click",function(a){$(a.target).hasClass("settings-dropdown")||$(".settings-dropdown").hide()})}}),Object.defineProperty(c.prototype,"showLikedEventsClickHandler",{writable:!0,configurable:!0,value:function(){"use strict";this.setState({showLiked:!0})}}),Object.defineProperty(c.prototype,"showAllEvents",{writable:!0,configurable:!0,value:function(){"use strict";this.setState({showLiked:!1})}}),Object.defineProperty(c.prototype,"clearStorageEventClickHandler",{writable:!0,configurable:!0,value:function(){"use strict";e.set({eventbritearoundme:""}),this.setState({events:[],location:null,radius:null,popularEvents:!1,nextWeekendEvents:!1,marathonEvents:!1,likedEvents:[],showLiked:!1}),$(React.findDOMNode(this.refs.searchInput)).typeahead("val","")}}),Object.defineProperty(c.prototype,"hideLoading",{writable:!0,configurable:!0,value:function(){"use strict";$(this.refs.eventsListContainer.getDOMNode()).removeClass("loading"),$(this.refs.loader.getDOMNode()).hide()}}),Object.defineProperty(c.prototype,"showLoading",{writable:!0,configurable:!0,value:function(){"use strict";$(this.refs.eventsListContainer.getDOMNode()).addClass("loading"),$(this.refs.loader.getDOMNode()).show()}}),Object.defineProperty(c.prototype,"searchRadiusChangeHandler",{writable:!0,configurable:!0,value:function(a){"use strict";var b=this.searchInput.value;""!=$.trim(b)&&(this.showLoading(),this.getData(b,a.target.value,this.popularEvents.checked,this.nextWeekendEvents.checked,this.marathonEvents.checked))}}),Object.defineProperty(c.prototype,"eventLikeHandler",{writable:!0,configurable:!0,value:function(a){"use strict";var b=this.state.likedEvents,c=this,d=b.filter(function(b){return b.id==a.id});d.length?b.splice(b.indexOf(d[0]),1):b.push(a),this.setState({likedEvents:b,silent:!0},function(){e.set({eventbritearoundme:JSON.stringify(c.state)})})}}),Object.defineProperty(c.prototype,"optionsHandler",{writable:!0,configurable:!0,value:function(a){"use strict";this.setState({popularEvents:this.popularEvents.checked,nextWeekendEvents:this.nextWeekendEvents.checked,marathonEvents:this.marathonEvents.checked});var b=this.searchInput.value;if(""!=$.trim(b)){this.showLoading();var c=$(a.target).attr("name");"popular-events"==c?this.getData(this.searchInput.value,this.searchRadiusInput.value,this.popularEvents.checked,this.nextWeekendEvents.checked,this.marathonEvents.checked):"next-weekend-events"==c?this.getData(this.searchInput.value,this.searchRadiusInput.value,this.popularEvents.checked,this.nextWeekendEvents.checked,this.marathonEvents.checked):this.getData(this.searchInput.value,this.searchRadiusInput.value,this.popularEvents.checked,this.nextWeekendEvents.checked,this.marathonEvents.checked)}}}),Object.defineProperty(c.prototype,"eventOptionsStyle",{writable:!0,configurable:!0,value:function(a){"use strict";var b=this.state.showLiked;return"!"==a&&(b=!b),{display:b?"none":""}}}),Object.defineProperty(c.prototype,"render",{writable:!0,configurable:!0,value:function(){"use strict";var c=this.state.location,d=this.state.radius,e=this.state.popularEvents,f=this.state.nextWeekendEvents,g=this.state.marathonEvents;return React.createElement("div",null,React.createElement(b,{onShowLikedEvents:this.showLikedEventsClickHandler.bind(this),onClearStorageEvent:this.clearStorageEventClickHandler.bind(this)}),React.createElement("div",{className:"loader",ref:"loader"},React.createElement("img",{src:"../img/icons/48x48.png"})),React.createElement("div",{className:"search-box"},React.createElement("div",{className:"block-header"},React.createElement("span",{className:"title"},"Popular events within",React.createElement("select",{className:"search-radius-input",ref:"searchRadiusInput",onChange:this.searchRadiusChangeHandler.bind(this),defaultValue:d},React.createElement("option",{value:"10"},"10"),React.createElement("option",{value:"25"},"25"),React.createElement("option",{value:"50"},"50")),"miles around ")),React.createElement("div",{className:"location-input"},React.createElement("span",{className:"location-marker"}),React.createElement("input",{autoFocus:!0,type:"text",ref:"searchInput",className:"search-input",placeholder:"Enter your location here",defaultValue:c}))),React.createElement("div",{className:"event-options",style:this.eventOptionsStyle()},React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"true",ref:"popularEvents",name:"popular-events",checked:""==e?!1:!0,onChange:this.optionsHandler.bind(this)}," Popular ")),React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"true",ref:"nextWeekendEvents",name:"next-weekend-events",checked:""==f?!1:!0,onChange:this.optionsHandler.bind(this)}," Next Weekend ")),React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"true",ref:"marathonEvents",name:"marathon-events",checked:""==g?!1:!0,onChange:this.optionsHandler.bind(this)}," Marathon "))),React.createElement("div",{className:"event-options",style:this.eventOptionsStyle("!")},React.createElement("a",{href:"#",onClick:this.showAllEvents.bind(this)}," Show all events ")),React.createElement("div",{className:"events-list-container",ref:"eventsListContainer"},React.createElement(a,React.__spread({},this.state,{onEventLike:this.eventLikeHandler.bind(this)}))))}}),e.get("eventbritearoundme",function(a){void 0!==a.eventbritearoundme&&(f=""!=a.eventbritearoundme?JSON.parse(a.eventbritearoundme):{}),React.render(React.createElement(c,React.__spread({},f)),g)})}();